<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="blog">
<meta property="og:type" content="website">
<meta property="og:title" content="jhmarryme&#39;s blog">
<meta property="og:url" content="https://wangdaye7.github.io/page/5/index.html">
<meta property="og:site_name" content="jhmarryme&#39;s blog">
<meta property="og:description" content="blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="jhmarryme&#39;s blog">
<meta name="twitter:description" content="blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://wangdaye7.github.io/page/5/">





  <title>jhmarryme's blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>
<a href="https://github.com/wangdaye7" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">jhmarryme's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wangdaye7.github.io/2019/03/20/SpringSecurity使用记录/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jiahao Wang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://jhmarryme-1257584644.cos.ap-chengdu.myqcloud.com/hexo/jhmarryme.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jhmarryme's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/20/SpringSecurity使用记录/" itemprop="url">SpringSecurity使用记录</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-19T19:51:21Z">
                2019-03-19
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ssm练习/" itemprop="url" rel="index">
                    <span itemprop="name">ssm练习</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##理解(待完成)<br>当完成配置后,  对权限的控制就完全交给springsecurity管理了, 不需要再用controller进行控制了<br>配置access的角色时, 需要加上前缀ROLE_ </p>
<h2 id="使用记录"><a href="#使用记录" class="headerlink" title="使用记录"></a>使用记录</h2><h3 id="SimpleGrantedAuthority"><a href="#SimpleGrantedAuthority" class="headerlink" title="SimpleGrantedAuthority"></a>SimpleGrantedAuthority</h3><ul>
<li><p>用于new User() 对象时作为参数传递进去, 我的理解是一个简单的授权信息集合, 传递的类型为List<simplegrantedauthority>集合</simplegrantedauthority></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在service中的编写</span></span><br><span class="line"><span class="comment">//此处的&#123;noop&#125;需要加上, 因为使用的是明文</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> UserDetails <span class="title">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException </span>&#123;</span><br><span class="line">    UserInfo userInfo = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        userInfo = userDao.findByUsername(username);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//处理自己的用户对象封装成UserDetails 此处的User为框架提供的类, 而为了避免冲突 将自己的User类更名为Users</span></span><br><span class="line">    <span class="comment">//  User user=new User(userInfo.getUsername(),"&#123;noop&#125;"+userInfo.getPassword(),getAuthority(userInfo.getRoles()));</span></span><br><span class="line">    User user = <span class="keyword">new</span> User(userInfo.getUsername(), <span class="string">"&#123;noop&#125;"</span> + userInfo.getPassword(), userInfo.getStatus() == <span class="number">0</span> ? <span class="keyword">false</span> : <span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, getAuthority(userInfo.getRoles()));</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//作用就是返回一个List集合，集合中装入的是角色描述</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;SimpleGrantedAuthority&gt; <span class="title">getAuthority</span><span class="params">(List&lt;Role&gt; roles)</span> </span>&#123;</span><br><span class="line">    List&lt;SimpleGrantedAuthority&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Role role : roles) &#123;</span><br><span class="line">        <span class="comment">//需要加上前缀ROLE_  对应spring-security.xml中的配置</span></span><br><span class="line">        list.add(<span class="keyword">new</span> SimpleGrantedAuthority(<span class="string">"ROLE_"</span> + role.getRoleName()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="对密码进行加密"><a href="#对密码进行加密" class="headerlink" title="对密码进行加密"></a>对密码进行加密</h3><ol>
<li><p>在spring-security.xml配置PasswordEncoder对象</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 切换成数据库中的用户名和密码 --&gt;</span><br><span class="line">&lt;security:authentication-manager&gt;</span><br><span class="line">    &lt;security:authentication-provider user-service-ref=<span class="string">"userService"</span>&gt;</span><br><span class="line">        &lt;!-- 配置加密的方式--&gt;</span><br><span class="line">    &lt;security:password-encoder ref=<span class="string">"passwordEncoder"</span>/&gt;</span><br><span class="line">    &lt;/security:authentication-provider&gt;</span><br><span class="line">&lt;/security:authentication-manager&gt;</span><br><span class="line">&lt;!-- 配置加密类 --&gt;</span><br><span class="line">&lt;bean id=<span class="string">"passwordEncoder"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder"</span>/&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>保存用户时对用户的加密<br>在service中进行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Users user)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//对存入的密码进行加密</span></span><br><span class="line">    user.setPassword(passwordEncoder.encode(user.getPassword()));</span><br><span class="line">    userDao.save(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>security中的验证就不需要在密码前添加”{noop}”了</p>
</li>
</ol>
<h3 id="服务器端方法级权限控制"><a href="#服务器端方法级权限控制" class="headerlink" title="服务器端方法级权限控制"></a>服务器端方法级权限控制</h3><p>Spring Security在方法的权限控制上<br>支持三种类型的注解，JSR-250注解、@Secured注解和支持表达式的注解，这三种注解默认都是没有启用的，需要<br>单独通过global-method-security元素的对应属性进行启用<br><strong>其中JSR-250可以省略前缀ROLE_  而Secured不可以</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配置文件</span></span><br><span class="line">&lt;security:global-method-security jsr250-annotations=<span class="string">"enabled"</span>/&gt;</span><br><span class="line">&lt;security:global-method-security secured-annotations=<span class="string">"enabled"</span>/&gt;</span><br><span class="line">&lt;security:global-method-security pre-post-annotations=<span class="string">"disabled"</span>/&gt;</span><br><span class="line"><span class="comment">//注解开启</span></span><br><span class="line"><span class="meta">@EnableGlobalMethodSecurity</span> ：Spring Security默认是禁用注解的，要想开启注解，需要在继承</span><br><span class="line">WebSecurityConfigurerAdapter的类上加<span class="meta">@EnableGlobalMethodSecurity</span>注解，并在该类中将</span><br><span class="line">AuthenticationManager定义为Bean。</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>JSR-250注解<br>需要先添加依赖:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;javax.annotation&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jsr250-api&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@RolesAllowed</span>表示访问对应方法时所应该具有的角色</span><br><span class="line">示例：</span><br><span class="line"><span class="meta">@RolesAllowed</span>(&#123;<span class="string">"USER"</span>, <span class="string">"ADMIN"</span>&#125;) 该方法只要具有<span class="string">"USER"</span>, <span class="string">"ADMIN"</span>任意一种权限就可以访问。这里可以省</span><br><span class="line">略前缀ROLE_，实际的权限可能是ROLE_ADMIN</span><br><span class="line"><span class="meta">@PermitAll</span>表示允许所有的角色进行访问，也就是说不进行权限控制</span><br><span class="line"><span class="meta">@DenyAll</span>是和PermitAll相反的，表示无论什么角色都不能访问</span><br></pre></td></tr></table></figure>
</li>
<li><p>支持表达式的注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">示例：</span><br><span class="line"><span class="meta">@PreAuthorize</span>(<span class="string">"#userId == authentication.principal.userId or hasAuthority(‘ADMIN’)"</span>)</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">changePassword</span><span class="params">(@P(<span class="string">"userId"</span>)</span> <span class="keyword">long</span> userId )</span>&#123; &#125;</span><br><span class="line">这里表示在changePassword方法执行之前，判断方法参数userId的值是否等于principal中保存的当前用户的</span><br><span class="line">userId，或者当前用户是否具有ROLE_ADMIN权限，两种符合其一，就可以访问该方法。</span><br><span class="line"><span class="meta">@PostAuthorize</span> 允许方法调用,但是如果表达式计算结果为<span class="keyword">false</span>,将抛出一个安全性异常</span><br><span class="line">示例：</span><br><span class="line"><span class="meta">@PostAuthorize</span></span><br><span class="line"><span class="function">User <span class="title">getUser</span><span class="params">(<span class="string">"returnObject.userId == authentication.principal.userId or</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">hasPermission(returnObject, 'ADMIN')"</span>)</span></span>;</span><br><span class="line"><span class="meta">@PostFilter</span> 允许方法调用,但必须按照表达式来过滤方法的结果</span><br><span class="line"><span class="meta">@PreFilter</span> 允许方法调用,但必须在进入方法之前过滤输入值</span><br></pre></td></tr></table></figure>
</li>
<li><p>@Secured注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Secured</span>注解标注的方法进行权限控制的支持，其值默认为disabled。</span><br><span class="line">示例：</span><br><span class="line"><span class="meta">@Secured</span>(<span class="string">"IS_AUTHENTICATED_ANONYMOUSLY"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Account <span class="title">readAccount</span><span class="params">(Long id)</span></span>;</span><br><span class="line"><span class="meta">@Secured</span>(<span class="string">"ROLE_TELLER"</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h3><p>无法进行权限控制, 用注解进行配置后还是所有人都可以访问, 查阅后发现将将注解从controller层移动到service可以解决<br>    <strong>解决的方法</strong><br>    将配置文件:<br>    <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;security:global-method-security jsr250-annotations=<span class="string">"enabled"</span>/&gt;</span><br><span class="line">&lt;security:global-method-security secured-annotations=<span class="string">"enabled"</span>/&gt;</span><br><span class="line">&lt;security:global-method-security pre-post-annotations=<span class="string">"disabled"</span>/&gt;</span><br></pre></td></tr></table></figure></p>
<p><strong>放入spring-mvc文件中配置, 而此时不能自动导入命名空间约束, 导入的话运行会报异常</strong><br>手动添加<br>    <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xmlns:security=<span class="string">"http://www.springframework.org/schema/security"</span></span><br><span class="line"></span><br><span class="line">http:<span class="comment">//www.springframework.org/schema/security</span></span><br><span class="line">http:<span class="comment">//www.springframework.org/schema/security/spring-security.xsd</span></span><br></pre></td></tr></table></figure></p>
<p>到相应的位置</p>
<h3 id="页面端标签控制权限"><a href="#页面端标签控制权限" class="headerlink" title="页面端标签控制权限"></a>页面端标签控制权限</h3><ul>
<li><p>在jsp页面中可以使用spring security提供的权限标签来进行权限控制<br>  maven导入</p>
  <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework.security&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-security-taglibs&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;version&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>  页面导入</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@taglib</span> uri=<span class="string">"http://www.springframework.org/security/tags"</span> prefix=<span class="string">"security"</span>%&gt;</span><br></pre></td></tr></table></figure>
<p>  <strong>注意的问题</strong><br>  在jsp页面中使用了SPEL表达式, 需要在spring-security.xml 开启SPEL表达式支持<br>  或者配置一个bean</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">"webexpressionHandler"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.security.web.access.expression.DefaultWebSecurityExpressionHandler"</span> /&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>常用标签  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>. authorize</span><br><span class="line">authorize是用来判断普通权限的，通过判断用户是否具有对应的权限而控制其所包含内容的显示</span><br><span class="line">&lt;security:authorize access="" method="" url="" var=""&gt;&lt;/security:authorize&gt;</span><br><span class="line">&lt;security:authorize access="hasRole('ADMIN')" &gt;&lt;/security:authorize&gt; //只有ADMIN用户才能访问</span><br><span class="line">access： 需要使用表达式来判断权限，当表达式的返回结果为<span class="keyword">true</span>时表示拥有对应的权限</span><br><span class="line">method：method属性是配合url属性一起使用的，表示用户应当具有指定url指定method访问的权限，</span><br><span class="line">method的默认值为GET，可选值为http请求的<span class="number">7</span>种方法</span><br><span class="line">url：url表示如果用户拥有访问指定url的权限即表示可以显示authorize标签包含的内容</span><br><span class="line"><span class="keyword">var</span>：用于指定将权限鉴定的结果存放在pageContext的哪个属性中</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>. authentication</span><br><span class="line">&lt;security:authentication property=<span class="string">""</span> htmlEscape=<span class="string">""</span> scope=<span class="string">""</span> <span class="keyword">var</span>=<span class="string">""</span>/&gt;</span><br><span class="line">property： 只允许指定Authentication所拥有的属性，可以进行属性的级联获取，如“principle.username”，</span><br><span class="line">不允许直接通过方法进行调用</span><br><span class="line">htmlEscape：表示是否需要将html进行转义。默认为<span class="keyword">true</span>。</span><br><span class="line">scope：与<span class="keyword">var</span>属性一起使用，用于指定存放获取的结果的属性名的作用范围，默认我pageContext。Jsp中拥</span><br><span class="line">有的作用范围都进行进行指定</span><br><span class="line"><span class="keyword">var</span>： 用于指定一个属性名，这样当获取到了authentication的相关信息后会将其以<span class="keyword">var</span>指定的属性名进行存</span><br><span class="line">放，默认是存放在pageConext中</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="使用前的准备步骤"><a href="#使用前的准备步骤" class="headerlink" title="使用前的准备步骤"></a>使用前的准备步骤</h3><ol>
<li><p>导入依赖</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">    &lt;spring.version&gt;5.0.2.RELEASE&lt;/spring.version&gt;</span><br><span class="line">    &lt;spring.security.version&gt;5.0.1.RELEASE&lt;/spring.security.version&gt;</span><br><span class="line">&lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-security-web&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spring.security.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-security-config&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spring.security.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>web.xml添加</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;web-app xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">    xmlns=<span class="string">"http://java.sun.com/xml/ns/javaee"</span></span><br><span class="line">    xsi:schemaLocation=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span></span><br><span class="line">    version=<span class="string">"2.5"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 配置加载类路径的配置文件 --&gt;</span><br><span class="line">    &lt;context-param&gt;</span><br><span class="line">        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">        &lt;param-value&gt;classpath*:applicationContext.xml,classpath*:spring-security.xml&lt;/param-value&gt;</span><br><span class="line">    &lt;/context-param&gt;</span><br><span class="line">    &lt;!-- 配置监听器 --&gt;</span><br><span class="line">    &lt;listener&gt;</span><br><span class="line">        &lt;listener-<span class="class"><span class="keyword">class</span>&gt;<span class="title">org</span>.<span class="title">springframework</span>.<span class="title">web</span>.<span class="title">context</span>.<span class="title">ContextLoaderListener</span>&lt;/<span class="title">listener</span>-<span class="title">class</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">listener</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;!-- 配置监听器，监听<span class="title">request</span>域对象的创建和销毁的 --&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">listener</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">listener</span>-<span class="title">class</span>&gt;<span class="title">org</span>.<span class="title">springframework</span>.<span class="title">web</span>.<span class="title">context</span>.<span class="title">request</span>.<span class="title">RequestContextListener</span>&lt;/<span class="title">listener</span>-<span class="title">class</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">listener</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    &lt;<span class="title">filter</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">filter</span>-<span class="title">name</span>&gt;<span class="title">springSecurityFilterChain</span>&lt;/<span class="title">filter</span>-<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">filter</span>-<span class="title">class</span>&gt;<span class="title">org</span>.<span class="title">springframework</span>.<span class="title">web</span>.<span class="title">filter</span>.<span class="title">DelegatingFilterProxy</span>&lt;/<span class="title">filter</span>-<span class="title">class</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">filter</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">filter</span>-<span class="title">mapping</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">filter</span>-<span class="title">name</span>&gt;<span class="title">springSecurityFilterChain</span>&lt;/<span class="title">filter</span>-<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">url</span>-<span class="title">pattern</span>&gt;/*&lt;/<span class="title">url</span>-<span class="title">pattern</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">filter</span>-<span class="title">mapping</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">web</span>-<span class="title">app</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>核心文件spring-security.xml文件<br> 示例:</p>
 <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">    xmlns:security=<span class="string">"http://www.springframework.org/schema/security"</span></span><br><span class="line">    xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">    xsi:schemaLocation=<span class="string">"http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">    http://www.springframework.org/schema/security</span></span><br><span class="line"><span class="string">    http://www.springframework.org/schema/security/spring-security.xsd"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 配置不拦截的资源 --&gt;</span><br><span class="line">    &lt;security:http pattern=<span class="string">"/login.jsp"</span> security=<span class="string">"none"</span>/&gt;</span><br><span class="line">    &lt;security:http pattern=<span class="string">"/failer.jsp"</span> security=<span class="string">"none"</span>/&gt;</span><br><span class="line">    &lt;security:http pattern=<span class="string">"/css/**"</span> security=<span class="string">"none"</span>/&gt;</span><br><span class="line">    &lt;security:http pattern=<span class="string">"/img/**"</span> security=<span class="string">"none"</span>/&gt;</span><br><span class="line">    &lt;security:http pattern=<span class="string">"/plugins/**"</span> security=<span class="string">"none"</span>/&gt;</span><br><span class="line">    &lt;!--</span><br><span class="line">        配置具体的规则</span><br><span class="line">        auto-config=<span class="string">"true"</span>	不用自己编写登录的页面，框架提供默认登录页面</span><br><span class="line">        use-expressions=<span class="string">"false"</span>	是否使用SPEL表达式（没学习过）</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;security:http auto-config=<span class="string">"true"</span> use-expressions=<span class="string">"false"</span>&gt;</span><br><span class="line">        &lt;!-- 配置具体的拦截的规则 pattern=<span class="string">"请求路径的规则"</span> access=<span class="string">"访问系统的人，必须有ROLE_USER的角色"</span> --&gt;</span><br><span class="line">        &lt;security:intercept-url pattern=<span class="string">"/**"</span> access=<span class="string">"ROLE_USER,ROLE_ADMIN"</span>/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 定义跳转的具体的页面 --&gt;</span><br><span class="line">        &lt;security:form-login</span><br><span class="line">                login-page=<span class="string">"/login.jsp"</span></span><br><span class="line">                login-processing-url=<span class="string">"/login.do"</span></span><br><span class="line">                <span class="keyword">default</span>-target-url=<span class="string">"/index.jsp"</span></span><br><span class="line">                authentication-failure-url=<span class="string">"/failer.jsp"</span></span><br><span class="line">                authentication-success-forward-url=<span class="string">"/pages/main.jsp"</span></span><br><span class="line">        /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 关闭跨域请求 --&gt;</span><br><span class="line">        &lt;security:csrf disabled=<span class="string">"true"</span>/&gt;</span><br><span class="line">        &lt;!-- 退出 --&gt;</span><br><span class="line">        &lt;security:logout invalidate-session=<span class="string">"true"</span> logout-url=<span class="string">"/logout.do"</span> logout-success-url=<span class="string">"/login.jsp"</span> /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/security:http&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 切换成数据库中的用户名和密码 --&gt;</span><br><span class="line">    &lt;security:authentication-manager&gt;</span><br><span class="line">        &lt;security:authentication-provider user-service-ref=<span class="string">"userService"</span>&gt;</span><br><span class="line">            &lt;!-- 配置加密的方式</span><br><span class="line">            &lt;security:password-encoder ref=<span class="string">"passwordEncoder"</span>/&gt;--&gt;</span><br><span class="line">        &lt;/security:authentication-provider&gt;</span><br><span class="line">    &lt;/security:authentication-manager&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 配置加密类 --&gt;</span><br><span class="line">    &lt;bean id=<span class="string">"passwordEncoder"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder"</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 提供了入门的方式，在内存中存入用户名和密码</span><br><span class="line">    &lt;security:authentication-manager&gt;</span><br><span class="line">        &lt;security:authentication-provider&gt;</span><br><span class="line">            &lt;security:user-service&gt;</span><br><span class="line">                &lt;security:user name=<span class="string">"admin"</span> password=<span class="string">"&#123;noop&#125;admin"</span> authorities=<span class="string">"ROLE_USER"</span>/&gt;</span><br><span class="line">            &lt;/security:user-service&gt;</span><br><span class="line">        &lt;/security:authentication-provider&gt;</span><br><span class="line">    &lt;/security:authentication-manager&gt;</span><br><span class="line">    --&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>UserService需要继承类UserDetailsService</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> <span class="keyword">extends</span> <span class="title">UserDetailsService</span> </span>&#123;</span><br><span class="line">    <span class="function">List&lt;Users&gt; <span class="title">findAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">save</span><span class="params">(Users user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Users <span class="title">findById</span><span class="params">(String id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addRoleToUser</span><span class="params">(String userId, String[] ids)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>不经过数据库时:</p>
 <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">    xmlns:security=<span class="string">"http://www.springframework.org/schema/security"</span></span><br><span class="line">    xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">    xsi:schemaLocation=<span class="string">"http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/security</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/security/spring-security.xsd"</span>&gt;        </span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line">    &lt;!-- 配置不过滤的资源（静态资源及登录相关） --&gt;</span><br><span class="line">    &lt;security:http security=<span class="string">"none"</span> pattern=<span class="string">"/login.html"</span> /&gt;</span><br><span class="line">    &lt;security:http security=<span class="string">"none"</span> pattern=<span class="string">"/failer.html"</span> /&gt;</span><br><span class="line">    &lt;security:http auto-config=<span class="string">"true"</span> use-expressions=<span class="string">"false"</span> &gt;</span><br><span class="line">        &lt;!-- 配置资料连接，表示任意路径都需要ROLE_USER权限 --&gt;</span><br><span class="line">        &lt;security:intercept-url pattern=<span class="string">"/**"</span> access=<span class="string">"ROLE_USER"</span> /&gt;</span><br><span class="line">        &lt;!-- 自定义登陆页面，login-page 自定义登陆页面 authentication-failure-url 用户权限校验失败之后才会跳转到这个页面，如果数据库中没有这个用户则不会跳转到这个页面。 </span><br><span class="line">            <span class="keyword">default</span>-target-url 登陆成功后跳转的页面。 注：登陆页面用户名固定 username，密码 password，action:login --&gt;</span><br><span class="line">        &lt;security:form-login login-page=<span class="string">"/login.html"</span></span><br><span class="line">            login-processing-url=<span class="string">"/login"</span> username-parameter=<span class="string">"username"</span></span><br><span class="line">            password-parameter=<span class="string">"password"</span> authentication-failure-url=<span class="string">"/failer.html"</span></span><br><span class="line">            <span class="keyword">default</span>-target-url=<span class="string">"/success.html"</span> </span><br><span class="line">            /&gt;</span><br><span class="line">        &lt;!-- 登出， invalidate-session 是否删除session logout-url：登出处理链接 logout-success-url：登出成功页面 </span><br><span class="line">            注：登出操作 只需要链接到 logout即可登出当前用户 --&gt;</span><br><span class="line">        &lt;security:logout invalidate-session=<span class="string">"true"</span> logout-url=<span class="string">"/logout"</span></span><br><span class="line">            logout-success-url=<span class="string">"/login.jsp"</span> /&gt;</span><br><span class="line">        &lt;!-- 关闭CSRF,默认是开启的 --&gt;</span><br><span class="line">        &lt;security:csrf disabled=<span class="string">"true"</span> /&gt;</span><br><span class="line">    &lt;/security:http&gt;</span><br><span class="line">    &lt;security:authentication-manager&gt;</span><br><span class="line">        &lt;security:authentication-provider&gt;</span><br><span class="line">            &lt;security:user-service&gt;</span><br><span class="line">                &lt;security:user name=<span class="string">"user"</span> password=<span class="string">"&#123;noop&#125;user"</span></span><br><span class="line">                    authorities=<span class="string">"ROLE_USER"</span> /&gt;</span><br><span class="line">                &lt;security:user name=<span class="string">"admin"</span> password=<span class="string">"&#123;noop&#125;admin"</span></span><br><span class="line">                    authorities=<span class="string">"ROLE_ADMIN"</span> /&gt;</span><br><span class="line">            &lt;/security:user-service&gt;</span><br><span class="line">        &lt;/security:authentication-provider&gt;</span><br><span class="line">    &lt;/security:authentication-manager&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wangdaye7.github.io/2019/03/18/howToSpeakEnglishWell/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jiahao Wang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://jhmarryme-1257584644.cos.ap-chengdu.myqcloud.com/hexo/jhmarryme.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jhmarryme's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/18/howToSpeakEnglishWell/" itemprop="url">howToSpeakEnglishWell</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-17T22:53:12Z">
                2019-03-17
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/英语/" itemprop="url" rel="index">
                    <span itemprop="name">英语</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="常用英语口语会话"><a href="#常用英语口语会话" class="headerlink" title="常用英语口语会话"></a>常用英语口语会话</h2><h2 id="first-day"><a href="#first-day" class="headerlink" title="first day"></a>first day</h2><p><a href="https://www.youtube.com/watch?v=L5pZoGKlZ_k" target="_blank" rel="noopener">links to youtube</a><br>    <strong> Hi. Could you help me, please?   您能帮我个忙么？<br>    I’m lost.   我迷路了。<br>    Go straight and then turn left!   直走然后左转。<br>    I’m trying to get to the mall.   我想去购物商城。<br>    Do you know where I can find a shoe store?   请问鞋店在哪?<br>    This way.   这边走（也可以表示礼让的时候这边请）<br>    How much is it?  这个多少钱？<br>    Can you do any better?   你能给个更好的价钱么？<br>    How about ten dollars? /  Would you take ten dollars?    十块钱怎么样？<br>    If I took two, would you give me a discount?  我要是买两件的话，你能给打个折么？<br>    Do you have this shirt in a small?  这件衬衫有小号的么？<br>    Can you break this bill for me, please?   请问能帮我换成零钱么？<br>    Two fives and a ten please.    两个五块和一个十块。<br>    Where can I pay?   在哪交钱。<br>    Here you are.   给你。<br>    Could I ask you a question?   我能问你一个问题么？<br>    Do you have a moment/minute?    你现在有空么？<br>    Do you have any siblings?          你有兄弟姐妹么？<br>    Do you have any brothers or sisters? 你有兄弟姐妹么？<br>    I’m an only child.     我是独生子女<br>    How old is your kid/child?  你的孩子多大了？<br>    How are the kids?   孩子们怎样？<br>    They grow so fast !   他们长的真快啊。<br>    How’s the family?  家人们还好么？<br>    Long time, no see!    好久不见（中式表达方式）<br>    What’s new?   生活有什么变化么？<br>    Are you still working at the bank?      你还在银行上班么？<br>    It’s a nice day!  今天天气真不错。 （陌生人之间的万能开头语）<br>    I like your dress 我喜欢你的裙子 （面对夸奖，礼貌回应 Thank you）<br>    Your daughter is so beautiful!   你的女儿真漂亮！<br>    Your baby is so cute !!   你的宝宝真可爱 （婴儿一般用cute）<br>    What’s your baby’s name?   你的宝宝叫什么名字？<br>    Your garden’s so beautiful!  你的花园真好看。<br>    What would you like for dinner?  晚餐你想吃些什么？<br>    Dumplings  饺子<br>    Sounds great !    听起来真不错！<br>    My treat.     我请客。<br>    Help yourself.     请随意。<br>    After you.     您先请。（一般乘坐电梯或是礼让的时候）<br>    I look forward to seeing you again.      希望再次见到你 / 期待与你的再次会面。<br>    （用seeing 是为了搭配 look forward。   回答的时候可以直接用：Me too.）<br>    Are you ok?   你没事吧？<br>    I feel sick. / I am sick.      我感觉不舒服 /   我病了  （前一种表示主观的感受，后一种表示已经确定自己病了）。<br>    What should I do?  我该怎么办？<br>    Do you want to go to the hospital ?      你要不要去医院呢？<br>    Are you hurt ?  你受伤了么？ （hurt 不只可以指生理方面，也可以指心理方面： I feel hurt.）<br>    Don’t worry.   不要担心。<br>    Calm down.    冷静点。<br>    I see！  我明白了！ （别人说了一些是事情，你突然明白了）<br>    I didn’t mean it .  我不是故意的。<br>    Never mind.    不要紧的，没关系的。 </strong></p>
<h2 id="第四天"><a href="#第四天" class="headerlink" title="第四天"></a>第四天</h2><p><a href="https://www.youtube.com/watch?v=nY7C_r2OEg8" target="_blank" rel="noopener">link to youtube</a></p>
<pre><code>What brings you here today？ 什么风把你吹来了
What’s the matter?
My knees hurt. My knees are in pain. It’s painful to watch that.
我的膝盖很疼, 不能直接说my knees are painful. 使用painful要用不定式.
How long has it been? About/Roughly three weeks.
有多长时间了?   
You should’ve come earlier. It didn’t bother me much before.
你应该早点来, 之前疼的不是很厉害.
Have a seat. Let me examine it. It’s nothing serious.
请坐,    让我检查一下, 不是很严重
Are you serious? I’m serious. Why are you so serious?
你是认真的吗？ 你怎么这么严肃， 放不开
Try these exercises. Exercise every day. I mean it. I didn’t mean it.
Could you refer me to a specialist? You don’t need one. You’ll be fine.
It’s just a matter of time.
只是时间的问题
I recommend you see a physiotherapist. I feel he did a good job.
He said I have a very good/positive attitude. He has an attitude.
这里的attitude本身就有消极/不好态度的意思, 所以不用加negative
Don’t give me attitude. 
I recovered very fast. I thanked him for everything.
Is the tax included in the price? It’s eighty dollars plus tax.
Do you want a receipt?
How do you like your doctor?
He’s always on time. I can’t believe it. He’s always in a rush.
What’s the rush?
I wouldn’t recommend him.
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wangdaye7.github.io/2019/03/17/mybatis使用记录/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jiahao Wang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://jhmarryme-1257584644.cos.ap-chengdu.myqcloud.com/hexo/jhmarryme.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jhmarryme's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/17/mybatis使用记录/" itemprop="url">mybatis使用记录</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-17T12:46:21Z">
                2019-03-17
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ssm练习/" itemprop="url" rel="index">
                    <span itemprop="name">ssm练习</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="注解中的使用"><a href="#注解中的使用" class="headerlink" title="注解中的使用"></a>注解中的使用</h2><h3 id="当结果对象中的属性与表中的数据-类型不一致时-表中存放的是外键-引用其他表中的id-而结果集对象中存放的是根据这个id对应的对象"><a href="#当结果对象中的属性与表中的数据-类型不一致时-表中存放的是外键-引用其他表中的id-而结果集对象中存放的是根据这个id对应的对象" class="headerlink" title="当结果对象中的属性与表中的数据 类型不一致时(表中存放的是外键 引用其他表中的id, 而结果集对象中存放的是根据这个id对应的对象)"></a>当结果对象中的属性与表中的数据 类型不一致时(表中存放的是外键 引用其他表中的id, 而结果集对象中存放的是根据这个id对应的对象)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有订单信息, 其中根据产品id又查询产品, 并将产品一并封装到结果集中了. 相当于两次查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Select</span>(<span class="string">"select * from orders"</span>)</span><br><span class="line">    <span class="meta">@Results</span>(&#123;</span><br><span class="line">            <span class="meta">@Result</span>(id = <span class="keyword">true</span>, column = <span class="string">"id"</span>, property = <span class="string">"id"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(column = <span class="string">"orderNum"</span>, property = <span class="string">"orderNum"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(column = <span class="string">"orderTime"</span>, property = <span class="string">"orderTime"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(column = <span class="string">"orderStatus"</span>, property = <span class="string">"orderStatus"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(column = <span class="string">"peopleCount"</span>, property = <span class="string">"peopleCount"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(column = <span class="string">"payType"</span>, property = <span class="string">"payType"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(column = <span class="string">"orderDesc"</span>, property = <span class="string">"orderDesc"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(column = <span class="string">"peopleCount"</span>, property = <span class="string">"peopleCount"</span>),</span><br><span class="line">            <span class="comment">// 表中存放的为外键, 引用产品id, 但是要将这个id重新映射为结果集中对应的类型product 需要进行第二次查询并封装@One适用于一对一映射 @Many为多对多</span></span><br><span class="line">            <span class="comment">//其中的select为相应dao的全限定类名, 可以用JavaType指定内部查询的返回类型</span></span><br><span class="line">            <span class="meta">@Result</span>(column = <span class="string">"productId"</span>, property = <span class="string">"product"</span>, one = <span class="meta">@One</span>(</span><br><span class="line">                    select = <span class="string">"jhmarryme.dao.ProductDao.findById"</span></span><br><span class="line">            )),</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Orders&gt; <span class="title">findAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查找订单</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from orders where id in (select orderId from order_traveller where orderId = #&#123;id&#125;)"</span>)</span><br><span class="line">    <span class="meta">@Results</span>(&#123;</span><br><span class="line">            <span class="meta">@Result</span>(id = <span class="keyword">true</span>, column = <span class="string">"id"</span>, property = <span class="string">"id"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(column = <span class="string">"orderTime"</span>, property = <span class="string">"orderTime"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(column = <span class="string">"orderNum"</span>, property = <span class="string">"orderNum"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(column = <span class="string">"orderStatus"</span>, property = <span class="string">"orderStatus"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(column = <span class="string">"peopleCount"</span>, property = <span class="string">"peopleCount"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(column = <span class="string">"payType"</span>, property = <span class="string">"payType"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(column = <span class="string">"orderDesc"</span>, property = <span class="string">"orderDesc"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(column = <span class="string">"productId"</span>, property = <span class="string">"product"</span>, one = <span class="meta">@One</span>(</span><br><span class="line">                    select = <span class="string">"jhmarryme.dao.ProductDao.findById"</span></span><br><span class="line">            )),</span><br><span class="line">            <span class="meta">@Result</span>(column = <span class="string">"memberId"</span>, property = <span class="string">"member"</span>, one = <span class="meta">@One</span>(</span><br><span class="line">                    select = <span class="string">"jhmarryme.dao.MemberDao.findById"</span></span><br><span class="line">            )),</span><br><span class="line">            <span class="comment">//此处当返回值为list集合的时候, 如果要写JavaType值必须是List.class  不是查找的类.class, 可以不写</span></span><br><span class="line">            <span class="meta">@Result</span>(column = <span class="string">"id"</span>, property = <span class="string">"travellers"</span>, many = <span class="meta">@Many</span>(</span><br><span class="line">                    select = <span class="string">"jhmarryme.dao.TravellerDao.findByOrdersId"</span></span><br><span class="line">            ))</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Orders <span class="title">findById</span><span class="params">(String id)</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="复习SQL语法"><a href="#复习SQL语法" class="headerlink" title="复习SQL语法"></a>复习SQL语法</h3><ul>
<li>left join(左联接) 返回包括左表中的所有记录和右表中联结字段相等的记录 </li>
<li>right join(右联接) 返回包括右表中的所有记录和左表中联结字段相等的记录</li>
<li>inner join(等值连接) 只返回两个表中联结字段相等的行</li>
</ul>
<h3 id="pageHelper插件的使用"><a href="#pageHelper插件的使用" class="headerlink" title="pageHelper插件的使用"></a>pageHelper插件的使用</h3><p>在调用service时使用插件, 当controller收到了返回的参数result时, 使用new PageInfo(result) 将此bean传到jsp页面,  这个就是分页的bean, 具体属性查看该对象<br><img src="https://jhmarryme-1257584644.cos.ap-chengdu.myqcloud.com/hexo/6.PageHelper%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4.bmp" alt="使用步骤"><br><a href="https://github.com/pagehelper/Mybatis-PageHelper/blob/master/wikis/zh/HowToUse.md" target="_blank" rel="noopener">git中文文档</a><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//applicationContext.xml中</span></span><br><span class="line">&lt;!-- 把交给IOC管理 SqlSessionFactory --&gt;</span><br><span class="line">&lt;bean id=<span class="string">"sqlSessionFactory"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span><br><span class="line">&lt;property name=<span class="string">"dataSource"</span> ref=<span class="string">"dataSource"</span> /&gt;</span><br><span class="line">&lt;!-- 传入PageHelper的插件 --&gt;</span><br><span class="line">&lt;property name=<span class="string">"plugins"</span>&gt;</span><br><span class="line">        &lt;array&gt;</span><br><span class="line">        &lt;!-- 传入插件的对象 --&gt;</span><br><span class="line">        &lt;bean <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.github.pagehelper.PageInterceptor"</span>&gt;</span><br><span class="line">                &lt;property name=<span class="string">"properties"</span>&gt;</span><br><span class="line">                &lt;props&gt;</span><br><span class="line">                        &lt;prop key="helperDialect"&gt;mysql&lt;/prop&gt;</span><br><span class="line">                        &lt;prop key="reasonable"&gt;true&lt;/prop&gt;</span><br><span class="line">                &lt;/props&gt;</span><br><span class="line">                &lt;/property&gt;</span><br><span class="line">        &lt;/bean&gt;</span><br><span class="line">        &lt;/array&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//controller中</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrdersService ordersService;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/findAll.do"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">findAll</span><span class="params">(@RequestParam(name = <span class="string">"page"</span>, required = <span class="keyword">true</span>, defaultValue = <span class="string">"1"</span>)</span> Integer page, @<span class="title">RequestParam</span><span class="params">(name = <span class="string">"size"</span>, required = <span class="keyword">true</span>, defaultValue = <span class="string">"4"</span>)</span> Integer size) <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ModelAndView view = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">        List&lt;Orders&gt; ordersList = ordersService.findAll(page, size);</span><br><span class="line">        <span class="comment">//插件提供的分页Bean对象</span></span><br><span class="line">        PageInfo pageInfo = <span class="keyword">new</span> PageInfo(ordersList);</span><br><span class="line">        view.addObject(<span class="string">"pageInfo"</span>, pageInfo);</span><br><span class="line">        System.out.println(ordersList);</span><br><span class="line">        <span class="keyword">for</span> (Orders order : ordersList)&#123;</span><br><span class="line">            System.out.println(order);</span><br><span class="line">        &#125;</span><br><span class="line">        view.setViewName(<span class="string">"orders-list"</span>);</span><br><span class="line">        <span class="keyword">return</span> view;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//service中</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Orders&gt; <span class="title">findAll</span><span class="params">(<span class="keyword">int</span> page, <span class="keyword">int</span> size)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//使用分页插件</span></span><br><span class="line">        PageHelper.startPage(page, size);</span><br><span class="line">        <span class="keyword">return</span> ordersDao.findAll();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="主键操作"><a href="#主键操作" class="headerlink" title="主键操作"></a>主键操作</h3><ol>
<li><p>使用UUID作为主键</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Insert</span>(<span class="string">"insert into users(id) values(REPLACE(UUID(),'-', ''))</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>插入数据时返回自增的主键</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Insert</span>(<span class="string">"insert into tbl_user (name, age) values (#&#123;name&#125;, #&#123;age&#125;)"</span>)</span><br><span class="line"><span class="meta">@Options</span>(useGeneratedKeys=<span class="keyword">true</span>, keyProperty=<span class="string">"userId"</span>, keyColumn=<span class="string">"id"</span>)</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insertUser</span><span class="params">(User user)</span></span>;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="当两个参数都为一般类型时-需要进行参数的声明"><a href="#当两个参数都为一般类型时-需要进行参数的声明" class="headerlink" title="当两个参数都为一般类型时, 需要进行参数的声明"></a>当两个参数都为一般类型时, 需要进行参数的声明</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addRoleToUser</span><span class="params">(@Param(<span class="string">"userId"</span>)</span> String userId, @<span class="title">Param</span><span class="params">(<span class="string">"roleId"</span>)</span> String id)</span>;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wangdaye7.github.io/2019/03/17/权限管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jiahao Wang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://jhmarryme-1257584644.cos.ap-chengdu.myqcloud.com/hexo/jhmarryme.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jhmarryme's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/17/权限管理/" itemprop="url">ssm权限管理学习</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-17T12:46:21Z">
                2019-03-17
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ssm练习/" itemprop="url" rel="index">
                    <span itemprop="name">ssm练习</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><ol>
<li><p>不能创建表 error:150</p>
<ul>
<li>引用的外键类型定义有误, 与其他表中的不符</li>
<li>表名用<code></code>包裹</li>
</ul>
</li>
<li><p>由于spring不能自动进行date类型的数据格式注入所以:<br>存入日期型数据时, 需要使用@DateTimeFormat注解, 在实体类的类型中加上此注解, 可以自动进行日期型的数据格式注入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DateTimeFormat</span>(pattern = <span class="string">"yyyy-MM-dd"</span>)</span><br><span class="line">    <span class="keyword">private</span> Date departureTime; <span class="comment">// 出发时间</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>另一种方案, (待确认效果)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@InitBinder</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initBinder</span><span class="params">(WebDataBinder binder)</span> </span>&#123;</span><br><span class="line">binder.registerCustomEditor(Date.class, <span class="keyword">new</span> MyDateEdit(<span class="string">"yyyy-MM-dd HH:mm"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ol start="3">
<li><p>实现分页功能<br>通过pageHelper实现, 具体用法写在了Mybatis使用记录里</p>
</li>
<li><p>使用SpringSecurity实现的登陆验证控制, 存入密码时进行加密.<br>具体用法写在了SpringSecurity使用记录里</p>
</li>
<li><p>对mybatis的一些用法的接触<br>对Results封装数据, 其中@One 和 @Many分别用来在结果集中嵌套注入一个数据和一个List集合, 在Mybatis使用记录里记录了一些用法</p>
</li>
<li><p>通过简单的自制日期转换工具实现 日期型和date类型相互转换<br>因为在实体类中没有直接使用date类型的数据作为展示, 而是定义了一个相应的时间str作为显示用, 所以需要进行转换</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DateUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将日期转换为字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> date</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> patt</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">dateToString</span><span class="params">(Date date, String patt)</span></span>&#123;</span><br><span class="line">        SimpleDateFormat simpleDateFormat = <span class="keyword">new</span> SimpleDateFormat(patt);</span><br><span class="line">        String format = simpleDateFormat.format(date);</span><br><span class="line">        <span class="keyword">return</span> format;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  将字符串转换为日期</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> str</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> patt</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ParseException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title">StringToDate</span><span class="params">(String str, String patt)</span> <span class="keyword">throws</span> ParseException </span>&#123;</span><br><span class="line">        SimpleDateFormat simpleDateFormat = <span class="keyword">new</span> SimpleDateFormat(patt);</span><br><span class="line">        Date parse = simpleDateFormat.parse(str);</span><br><span class="line">        <span class="keyword">return</span> parse;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="权限管理相关"><a href="#权限管理相关" class="headerlink" title="权限管理相关"></a>权限管理相关</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wangdaye7.github.io/2019/03/17/LeetCode记录/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jiahao Wang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://jhmarryme-1257584644.cos.ap-chengdu.myqcloud.com/hexo/jhmarryme.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jhmarryme's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/17/LeetCode记录/" itemprop="url">LeetCode记录</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-17T12:46:21Z">
                2019-03-17
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/面试准备/" itemprop="url" rel="index">
                    <span itemprop="name">面试准备</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="leetCode清单"><a href="#leetCode清单" class="headerlink" title="leetCode清单"></a>leetCode清单</h1><ol>
<li>两数之和(1)<ul>
<li style="list-style: none"><input type="checkbox"> 是否掌握</li>
<li style="list-style: none"><input type="checkbox" checked> 是否复习</li>
<li style="list-style: none"><input type="checkbox" checked> 是否理解</li>
</ul>
</li>
<li>和为K的子数组(560)<ul>
<li style="list-style: none"><input type="checkbox"> 是否掌握</li>
<li style="list-style: none"><input type="checkbox" checked> 是否复习</li>
<li style="list-style: none"><input type="checkbox" checked> 是否理解</li>
</ul>
</li>
<li>两数相加(2)<ul>
<li style="list-style: none"><input type="checkbox"> 是否掌握</li>
<li style="list-style: none"><input type="checkbox"> 是否复习</li>
<li style="list-style: none"><input type="checkbox" checked> 是否理解</li>
</ul>
</li>
<li>两数相加2(2)<ul>
<li style="list-style: none"><input type="checkbox"> 是否掌握</li>
<li style="list-style: none"><input type="checkbox"> 是否复习</li>
<li style="list-style: none"><input type="checkbox" checked> 是否理解<h2 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h2><h3 id="HashMap相关"><a href="#HashMap相关" class="headerlink" title="HashMap相关"></a>HashMap相关</h3></li>
</ul>
</li>
<li><p>两数之和</p>
<ul>
<li><p>题目:给定一个整数数组 nums 和一个目标值 target，请你在该数组中找出和为目标值的那 两个 整数，并返回他们的数组下标。<br>你可以假设每种输入只会对应一个答案。但是，你不能重复利用这个数组中同样的元素。</p>
<p>示例:<br>给定 nums = [2, 7, 11, 15], target = 9</p>
<p>因为 nums[0] + nums[1] = 2 + 7 = 9<br>所以返回 [0, 1]</p>
</li>
<li><p>思路<br>从0开始遍历nums数组, 使用hashmap存放期望的值(target-nums[i])和索引值(i), 判断当前nums[i]是否是前面的需要的期望值, 如果是, 则代表找到了, 不是则继续下一次 </p>
</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] twoSum(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target) &#123;</span><br><span class="line">        Map&lt;Integer, Integer&gt; ans = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ans.containsKey(nums[i]))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;ans.get(nums[i]), i&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            ans.put(target - nums[i], i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><p>和为k的子数组</p>
<ul>
<li><p>题目<br>给定一个整数数组和一个整数 k，你需要找到该数组中和为 k 的连续的子数组的个数。<br>示例 1 :<br>输入:nums = [1,1,1], k = 2<br>输出: 2 , [1,1] 与 [1,1] 为两种不同的情况。<br>说明 :<br>数组的长度为 [1, 20,000]。<br>数组中元素的范围是 [-1000, 1000] ，且整数 k 的范围是 [-1e7, 1e7]。</p>
</li>
<li><p>思路<br>建立map表用于存储每个连续子数组sum求和出现的次数，初始化为（0,1），表示和为0的连续子数组出现1次。</p>
<p>sum的值是在对nums数组的循环中不断累加当前元素的，res的值则需要查找map中是否已存在sum-k的元素，也就是在查找此前所有从0项开始累加的连续子项和中有没有sum-k。</p>
<p>如果有的话，则说明从该项到当前项的连续子数组和必定为k，那么res则可以和这个sum的对应值，即这个sum出现的次数，相加得到新的res。</p>
<p>对于当前sum如果已存在与map中则其对应值+1，不存在则添加新项，初始值为1。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">subarraySum</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        Map&lt;Integer, Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++)&#123;</span><br><span class="line">            sum += nums[i];</span><br><span class="line">            <span class="comment">//如果k = 13 而此时sum = 20, 所以sum - k = 7, 查看是否有出现过7, 如果有则代表从该项到当前项的连续子数组和为13, 将出现过的次数加到结果</span></span><br><span class="line">            <span class="keyword">if</span>(map.containsKey(sum - k))&#123;</span><br><span class="line">                res += map.get(sum - k);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//因为这是一个包含负数的数组, 所有存在和为20的情况有很多种, 需要处理</span></span><br><span class="line">            map.put(sum, map.getOrDefault(sum, <span class="number">0</span>) + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h3 id="ListNode相关"><a href="#ListNode相关" class="headerlink" title="ListNode相关"></a>ListNode相关</h3><ol>
<li><p>两数相加</p>
<ul>
<li><p>题目<br>给出两个 非空 的链表用来表示两个非负的整数。其中，它们各自的位数是按照 逆序 的方式存储的，并且它们的每个节点只能存储 一位 数字。</p>
<p>如果，我们将这两个数相加起来，则会返回一个新的链表来表示它们的和。</p>
<p>您可以假设除了数字 0 之外，这两个数都不会以 0 开头。</p>
<p>示例：</p>
<p>输入：(2 -&gt; 4 -&gt; 3) + (5 -&gt; 6 -&gt; 4)<br>输出：7 -&gt; 0 -&gt; 8<br>原因：342 + 465 = 807</p>
</li>
</ul>
</li>
</ol>
<pre><code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListNode <span class="title">addTwoNumbers</span><span class="params">(ListNode l1, ListNode l2)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//定义一个进位标志</span></span><br><span class="line">        <span class="keyword">int</span> flag = <span class="number">0</span>;</span><br><span class="line">        ListNode p1 = l1;</span><br><span class="line">        ListNode p2 = l2;</span><br><span class="line">        ListNode res = <span class="keyword">new</span> ListNode(-<span class="number">1</span>);</span><br><span class="line">        ListNode cur = res;</span><br><span class="line">        <span class="keyword">while</span>(p1 != <span class="keyword">null</span> || p2 != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">int</span> x = (p1 != <span class="keyword">null</span>) ? p1.val : <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">int</span> y = (p2 != <span class="keyword">null</span>) ? p2.val : <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">int</span> sum = x + y + flag;</span><br><span class="line">            flag = sum / <span class="number">10</span>;</span><br><span class="line">            cur.next = <span class="keyword">new</span> ListNode(sum % <span class="number">10</span>);</span><br><span class="line">            cur = cur.next;</span><br><span class="line">            <span class="keyword">if</span>(p1 != <span class="keyword">null</span>)&#123;</span><br><span class="line">                p1 = p1.next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(p2 != <span class="keyword">null</span>)&#123;</span><br><span class="line">                p2 = p2.next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(flag &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            cur.next = <span class="keyword">new</span> ListNode(flag);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre><ol start="2">
<li>两数相加2<br> -题目<br> 给定两个非空链表来代表两个非负整数。数字最高位位于链表开始位置。它们的每个节点只存储单个数字。将这两数相加会返回一个新的链表。</li>
</ol>
<pre><code>你可以假设除了数字 0 之外，这两个数字都不会以零开头。

进阶:

如果输入链表不能修改该如何处理？换句话说，你不能对列表中的节点进行翻转。

示例:

输入: (7 -&gt; 2 -&gt; 4 -&gt; 3) + (5 -&gt; 6 -&gt; 4)
输出: 7 -&gt; 8 -&gt; 0 -&gt; 7
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListNode <span class="title">addTwoNumbers</span><span class="params">(ListNode l1, ListNode l2)</span> </span>&#123;</span><br><span class="line">        Stack&lt;Integer&gt; s1 = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">        Stack&lt;Integer&gt; s2 = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span>(l1 != <span class="keyword">null</span> || l2 != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(l1 != <span class="keyword">null</span>)&#123;</span><br><span class="line">                s1.push(l1.val);</span><br><span class="line">                l1 = l1.next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(l2 != <span class="keyword">null</span>)&#123;</span><br><span class="line">                s2.push(l2.val);</span><br><span class="line">                l2 = l2.next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> flag = <span class="number">0</span>;</span><br><span class="line">        ListNode head = <span class="keyword">null</span>;</span><br><span class="line">        ListNode temp = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">while</span>(!s1.empty() || !s2.empty())&#123;</span><br><span class="line">            <span class="keyword">int</span> x = (!s1.empty()) ? s1.pop() : <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">int</span> y = (!s2.empty()) ? s2.pop() : <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">int</span> sum = x + y + flag;</span><br><span class="line">            ListNode node = <span class="keyword">new</span> ListNode(sum % <span class="number">10</span>);</span><br><span class="line">            temp = head;</span><br><span class="line">            head = node;</span><br><span class="line">            head.next = temp;</span><br><span class="line">            head = node;</span><br><span class="line">            flag = sum / <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(flag &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            temp = head;</span><br><span class="line">            head = <span class="keyword">new</span> ListNode(<span class="number">1</span>);</span><br><span class="line">            head.next = temp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wangdaye7.github.io/2019/03/11/积累/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jiahao Wang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://jhmarryme-1257584644.cos.ap-chengdu.myqcloud.com/hexo/jhmarryme.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jhmarryme's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/11/积累/" itemprop="url">积累</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-11T15:44:21Z">
                2019-03-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/面试准备/" itemprop="url" rel="index">
                    <span itemprop="name">面试准备</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="拓宽知识面"><a href="#拓宽知识面" class="headerlink" title="拓宽知识面:"></a>拓宽知识面:</h2><pre><code>1. 什么是中间件
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wangdaye7.github.io/2019/03/07/ssm整合/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jiahao Wang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://jhmarryme-1257584644.cos.ap-chengdu.myqcloud.com/hexo/jhmarryme.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jhmarryme's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/07/ssm整合/" itemprop="url">ssm整合</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-06T16:22:07Z">
                2019-03-06
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ssm练习/" itemprop="url" rel="index">
                    <span itemprop="name">ssm练习</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="独立搭建第一次"><a href="#独立搭建第一次" class="headerlink" title="独立搭建第一次"></a>独立搭建第一次</h2><ol>
<li>工程环境搭建<ol>
<li>创建maven工程, 选择webapp模板, </li>
<li>导入坐标, 完善项目目录结构</li>
</ol>
</li>
<li>Spring配置<ol>
<li>导入常用约束</li>
<li>开启注解扫描, 配置哪些要扫描的包</li>
<li>编写测试类</li>
<li>测试Spring能否独立运行</li>
</ol>
</li>
<li><p>springMVC配置</p>
<ol>
<li>web.xml配置核心控制器<ul>
<li>核心控制器</li>
<li>中文乱码过滤器</li>
<li>过滤静态资源</li>
</ul>
</li>
<li><p>springmvc.xml配置</p>
<ol>
<li>导入常用约束</li>
<li>配置注解扫描<ul>
<li>只扫描web层</li>
</ul>
</li>
<li>配置视图解析器<ol>
<li>配置解析的目录和文件类型</li>
</ol>
</li>
<li><p>开启mvc注解支持</p>
</li>
<li><p>配置Tomcat</p>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<ol start="4">
<li><p>整合Spring和springmvc<br>核心目的就是为了在controller中调用service层方法,要让服务器能加载到Spring的配置文件</p>
<ol>
<li>web.xml中配置一个监听器, 在启动服务时创建一个容器(默认只能加载WEB-INF下的配置文件)</li>
<li>需要手动只能Spring配置文件位置<ol start="3">
<li>测试Controller中调用service方法</li>
</ol>
</li>
</ol>
</li>
<li><p>搭建和测试mybatis</p>
<ol>
<li>配置文件的编写<ul>
<li>配置数据源</li>
<li>配置包的路径, 如果是XML方式配置dao需要加载xml</li>
</ul>
</li>
<li>dao层使用注解配置</li>
<li>测试mybatis</li>
</ol>
</li>
<li><p>整合mybatis和Spring<br>把 mybatis 配置文件（SqlMapConfig.xml）中内容配置到 spring 配置文件中</p>
<ol>
<li>配置数据源</li>
<li>配置sqlSession工厂</li>
<li>配置要扫描的dao包</li>
<li>配置Spring事务管理器<ul>
<li>配置事务管理器</li>
<li>配置事务通知(作用的方法)</li>
<li>配置AOP<ul>
<li>配置AOP切入点</li>
</ul>
</li>
<li>配置事务通知与切入点的关系 </li>
<li>有需要的话开启注解支持</li>
</ul>
</li>
<li>由于配置了事务, 一定要在Springmvc的配置文件中排除扫描service, 不然没有事务处理能力<h2 id="问题总结"><a href="#问题总结" class="headerlink" title="问题总结"></a>问题总结</h2>1 . 控制台提示log4j找不到<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">log4j:<span class="function">WARN No appenders could be found <span class="keyword">for</span> <span class="title">logger</span> <span class="params">(org.springframework.core.env.StandardEnvironment)</span>.</span></span><br><span class="line"><span class="function">log4j:WARN Please initialize the log4j system properly.</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ol>
<p>导入配置文件即可</p>
<ol start="2">
<li><p>控制台输出语句乱码<br>configurations中的VM options里加上-Dfile.encoding=UTF-8</p>
</li>
<li><p>在Springmvc+mybatis中事务不回滚<br>Spring容器优先加载,是父容器，而SpringMVC产生的是子容器。子容器Controller进行扫描装配时装配的@Service注解的实例是没有经过事务加强处理，即没有事务处理能力的Service，而父容器进行初始化的Service是保证事务的增强处理能力的。如果不在子容器中将Service exclude掉，此时得到的将是原样的无事务处理能力的Service，因为在多上下文的情况下，如果同一个bean被定义两次，后面一个优先。</p>
</li>
<li><p>数据库查询中文乱码<br>在url后面加上?useUnicode=true&amp;characterEncoding=UTF-8指定编码集</p>
</li>
<li><p>修改代码后没有效果, maven重新clean-&gt;install一下</p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wangdaye7.github.io/2019/03/06/SpringMVC记录/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jiahao Wang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://jhmarryme-1257584644.cos.ap-chengdu.myqcloud.com/hexo/jhmarryme.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jhmarryme's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/06/SpringMVC记录/" itemprop="url">SpringMVC记录</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-06T15:33:12Z">
                2019-03-06
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ssm学习/" itemprop="url" rel="index">
                    <span itemprop="name">ssm学习</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><ol>
<li>使用$.post方法发送请求, controller接收时出现415错误<ul>
<li>原因是controller中使用了@RequestBody注解接收参数, 需要删掉, 如果使用$.ajax则不会出现此异常</li>
</ul>
</li>
<li><p>使用$.get方法发送请求, controller接收时出现400错误</p>
<ul>
<li>原因同上</li>
</ul>
</li>
<li><p>return “rediect:findAll.do”;  //controller中的返回值, 重定向</p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wangdaye7.github.io/2019/03/05/spring第三天/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jiahao Wang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://jhmarryme-1257584644.cos.ap-chengdu.myqcloud.com/hexo/jhmarryme.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jhmarryme's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/05/spring第三天/" itemprop="url">spring第三天</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-05T10:33:17Z">
                2019-03-05
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javaWeb/" itemprop="url" rel="index">
                    <span itemprop="name">javaWeb</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="今日概览"><a href="#今日概览" class="headerlink" title="今日概览"></a>今日概览</h2><p>1、spring中的JdbcTemplate<br>    JdbcTemplate的作用：<br>        它就是用于和数据库交互的，实现对表的CRUD操作<br>    如何创建该对象：<br>    对象中的常用方法：<br>2、作业：<br>    spring基于AOP的事务控制<br>3、spring中的事务控制<br>    基于XML的<br>    基于注解的</p>
<h2 id="Spring事务控制"><a href="#Spring事务控制" class="headerlink" title="Spring事务控制"></a>Spring事务控制</h2><ol>
<li><p>基于xml</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- spring中基于XML的声明式事务控制配置步骤</span><br><span class="line">        <span class="number">1</span>、配置事务管理器</span><br><span class="line">        <span class="number">2</span>、配置事务的通知</span><br><span class="line">                此时我们需要导入事务的约束 tx名称空间和约束，同时也需要aop的</span><br><span class="line">                使用tx:advice标签配置事务通知</span><br><span class="line">                    属性：</span><br><span class="line">                        id：给事务通知起一个唯一标识</span><br><span class="line">                        transaction-manager：给事务通知提供一个事务管理器引用</span><br><span class="line">        <span class="number">3</span>、配置AOP中的通用切入点表达式</span><br><span class="line">        <span class="number">4</span>、建立事务通知和切入点表达式的对应关系</span><br><span class="line">        <span class="number">5</span>、配置事务的属性</span><br><span class="line">               是在事务的通知tx:advice标签的内部</span><br><span class="line"></span><br><span class="line">     --&gt;</span><br><span class="line">    &lt;!-- 配置事务管理器 --&gt;</span><br><span class="line">    &lt;bean id=<span class="string">"transactionManager"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span><br><span class="line">        &lt;property name="dataSource" ref="dataSource"&gt;&lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 配置事务的通知--&gt;</span><br><span class="line">    &lt;tx:advice id=<span class="string">"txAdvice"</span> transaction-manager=<span class="string">"transactionManager"</span>&gt;</span><br><span class="line">        &lt;!-- 配置事务的属性</span><br><span class="line">                isolation：用于指定事务的隔离级别。默认值是DEFAULT，表示使用数据库的默认隔离级别。</span><br><span class="line">                propagation：用于指定事务的传播行为。默认值是REQUIRED，表示一定会有事务，增删改的选择。查询方法可以选择SUPPORTS。</span><br><span class="line">                read-only：用于指定事务是否只读。只有查询方法才能设置为<span class="keyword">true</span>。默认值是<span class="keyword">false</span>，表示读写。</span><br><span class="line">                timeout：用于指定事务的超时时间，默认值是-<span class="number">1</span>，表示永不超时。如果指定了数值，以秒为单位。</span><br><span class="line">                rollback-<span class="keyword">for</span>：用于指定一个异常，当产生该异常时，事务回滚，产生其他异常时，事务不回滚。没有默认值。表示任何异常都回滚。</span><br><span class="line">                no-rollback-<span class="keyword">for</span>：用于指定一个异常，当产生该异常时，事务不回滚，产生其他异常时事务回滚。没有默认值。表示任何异常都回滚。</span><br><span class="line">        --&gt;</span><br><span class="line">        &lt;tx:attributes&gt;</span><br><span class="line">            &lt;tx:method name=<span class="string">"*"</span> propagation=<span class="string">"REQUIRED"</span> read-only=<span class="string">"false"</span>/&gt;</span><br><span class="line">            &lt;tx:method name="find*" propagation="SUPPORTS" read-only="true"&gt;&lt;/tx:method&gt;</span><br><span class="line">        &lt;/tx:attributes&gt;</span><br><span class="line">    &lt;/tx:advice&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 配置aop--&gt;</span><br><span class="line">    &lt;aop:config&gt;</span><br><span class="line">        &lt;!-- 配置切入点表达式--&gt;</span><br><span class="line">        &lt;aop:pointcut id="pt1" expression="execution(* com.itheima.service.impl.*.*(..))"&gt;&lt;/aop:pointcut&gt;</span><br><span class="line">        &lt;!--建立切入点表达式和事务通知的对应关系 --&gt;</span><br><span class="line">        &lt;aop:advisor advice-ref="txAdvice" pointcut-ref="pt1"&gt;&lt;/aop:advisor&gt;</span><br><span class="line">    &lt;/aop:config&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>注解</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- spring中基于注解 的声明式事务控制配置步骤</span><br><span class="line">        <span class="number">1</span>、配置事务管理器</span><br><span class="line">        <span class="number">2</span>、开启spring对注解事务的支持</span><br><span class="line">        <span class="number">3</span>、在需要事务支持的地方使用<span class="meta">@Transactional</span>注解</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     --&gt;</span><br><span class="line">    &lt;!-- 配置事务管理器 --&gt;</span><br><span class="line">    &lt;bean id=<span class="string">"transactionManager"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span><br><span class="line">        &lt;property name="dataSource" ref="dataSource"&gt;&lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;!-- 开启spring对注解事务的支持--&gt;</span><br><span class="line">    &lt;tx:annotation-driven transaction-manager="transactionManager"&gt;&lt;/tx:annotation-driven&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>纯注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * spring的配置类，相当于bean.xml</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(<span class="string">"com.itheima"</span>)</span><br><span class="line"><span class="meta">@Import</span>(&#123;JdbcConfig.class,TransactionConfig.class&#125;)</span><br><span class="line"><span class="meta">@PropertySource</span>(<span class="string">"jdbcConfig.properties"</span>)</span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfiguration</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">************************</span><br><span class="line">**</span><br><span class="line"> * 和连接数据库相关的配置类</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;jdbc.driver&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;jdbc.url&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;jdbc.username&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;jdbc.password&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建JdbcTemplate</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataSource</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span>(name=<span class="string">"jdbcTemplate"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">createJdbcTemplate</span><span class="params">(DataSource dataSource)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JdbcTemplate(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建数据源对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span>(name=<span class="string">"dataSource"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">createDataSource</span><span class="params">()</span></span>&#123;</span><br><span class="line">        DriverManagerDataSource ds = <span class="keyword">new</span> DriverManagerDataSource();</span><br><span class="line">        ds.setDriverClassName(driver);</span><br><span class="line">        ds.setUrl(url);</span><br><span class="line">        ds.setUsername(username);</span><br><span class="line">        ds.setPassword(password);</span><br><span class="line">        <span class="keyword">return</span> ds;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">***********************</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 和事务相关的配置类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span>  <span class="title">TransactionConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用于创建事务管理器对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataSource</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span>(name=<span class="string">"transactionManager"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> PlatformTransactionManager <span class="title">createTransactionManager</span><span class="params">(DataSource dataSource)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DataSourceTransactionManager(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="基于注解的转账事务控制"><a href="#基于注解的转账事务控制" class="headerlink" title="基于注解的转账事务控制"></a>基于注解的转账事务控制</h2><ol>
<li>配置类:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;jdbc.driver&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;jdbc.url&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;jdbc.user&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;jdbc.password&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建jdbcTemplate</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataSource</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"jdbcTemplate"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">createJdbcTemplate</span><span class="params">(DataSource dataSource)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JdbcTemplate(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"dataSource"</span>)</span><br><span class="line">        <span class="function"><span class="keyword">public</span> DataSource <span class="title">createDataSource</span><span class="params">()</span></span>&#123;</span><br><span class="line">            DriverManagerDataSource ds = <span class="keyword">new</span> DriverManagerDataSource();</span><br><span class="line">            ds.setDriverClassName(driver);</span><br><span class="line">            ds.setUrl(url);</span><br><span class="line">            ds.setUsername(user);</span><br><span class="line">            ds.setPassword(password);</span><br><span class="line">            <span class="keyword">return</span> ds;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>测试类:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(classes = SpringConfig.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TxManagerTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IAccountService as;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTransfer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        as.transfer(<span class="string">"jh"</span>, <span class="string">"wjh"</span>, <span class="number">10f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wangdaye7.github.io/2019/03/04/spring第二天/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jiahao Wang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://jhmarryme-1257584644.cos.ap-chengdu.myqcloud.com/hexo/jhmarryme.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jhmarryme's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/04/spring第二天/" itemprop="url">spring第二天</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-04T12:46:21Z">
                2019-03-04
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javaWeb/" itemprop="url" rel="index">
                    <span itemprop="name">javaWeb</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="今日任务概览"><a href="#今日任务概览" class="headerlink" title="今日任务概览"></a>今日任务概览</h1><p>1、完善account案例<br>2、分析案例中问题<br>3、回顾之前的一个技术：动态代理<br>4、动态代理另一种实现方式<br>5、解决案例中的问题<br>6、AOP的概念<br>7、spring中的AOP相关术语<br>8、spring中基于XML和注解的AOP配置</p>
<h2 id="spring中基于XML和注解的AOP配置"><a href="#spring中基于XML和注解的AOP配置" class="headerlink" title="spring中基于XML和注解的AOP配置"></a>spring中基于XML和注解的AOP配置</h2><p>在Spring文档中搜索xmlns:aop找到约束.</p>
<ol>
<li><p>相关术语<br> Joinpoint(连接点):<br> 所谓连接点是指那些被拦截到的点。在 spring 中,这些点指的是方法,因为 spring 只支持方法类型的<br> 连接点。<br> Pointcut(切入点):<br> 所谓切入点是指我们要对哪些 Joinpoint 进行拦截的定义。<br> Advice(通知/增强):<br> 所谓通知是指拦截到 Joinpoint 之后所要做的事情就是通知。<br> 通知的类型：前置通知,后置通知,异常通知,最终通知,环绕通知。<br> Introduction(引介):<br> 引介是一种特殊的通知在不修改类代码的前提下, Introduction 可以在运行期为类动态地添加一些方<br> 法或 Field。<br> Target(目标对象):<br> 代理的目标对象。<br> Weaving(织入):<br> 是指把增强应用到目标对象来创建新的代理对象的过程。<br> spring 采用动态代理织入，而 AspectJ 采用编译期织入和类装载期织入。<br> Proxy（代理）:<br> 一个类被 AOP 织入增强后，就产生一个结果代理类。<br> Aspect(切面):<br> 是切入点和通知（引介）的结合。</p>
</li>
<li><p>导入约束</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">此处要导入 aop 的约束</span><br><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">"http://www.springframework.org/schema/beans"</span></span><br><span class="line"> xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line"> xmlns:aop=<span class="string">"http://www.springframework.org/schema/aop"</span></span><br><span class="line"> xsi:schemaLocation=<span class="string">"http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string"> http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string"> http://www.springframework.org/schema/aop</span></span><br><span class="line"><span class="string"> http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>XML的AOP配置及使用</p>
<ol>
<li><p>常用通知配置<br>XML中的配置:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--配置accountService--&gt;</span><br><span class="line">   &lt;bean id="accountService" class="jhmarryme.service.impl.AccountServiceImpl"&gt;&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">   &lt;!--配置logger对象--&gt;</span><br><span class="line">   &lt;bean id="logger" class="jhmarryme.utils.Logger"&gt;&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   &lt;!--开始Spring的AOP配置--&gt;</span><br><span class="line">   &lt;aop:config&gt;</span><br><span class="line">       &lt;!--配置切入点   此处配置必须在前面--&gt;</span><br><span class="line">       &lt;aop:pointcut id=<span class="string">"pt1"</span> expression=<span class="string">"execution(* jhmarryme.service.impl.*.*(..))"</span>/&gt;</span><br><span class="line">       &lt;aop:aspect id=<span class="string">"logAdvice"</span> ref=<span class="string">"logger"</span>&gt;</span><br><span class="line">           &lt;!-- 配置前置通知：在切入点方法执行之前执行</span><br><span class="line">           &lt;aop:before method="beforePrintLog" pointcut-ref="pt1" &gt;&lt;/aop:before&gt;--&gt;</span><br><span class="line"></span><br><span class="line">           &lt;!-- 配置后置通知：在切入点方法正常执行之后值。它和异常通知永远只能执行一个</span><br><span class="line">           &lt;aop:after-returning method="afterReturningPrintLog" pointcut-ref="pt1"&gt;&lt;/aop:after-returning&gt;--&gt;</span><br><span class="line"></span><br><span class="line">           &lt;!-- 配置异常通知：在切入点方法执行产生异常之后执行。它和后置通知永远只能执行一个</span><br><span class="line">           &lt;aop:after-throwing method="afterThrowingPrintLog" pointcut-ref="pt1"&gt;&lt;/aop:after-throwing&gt;--&gt;</span><br><span class="line">           &lt;!--顺序不能错--&gt;</span><br><span class="line">           &lt;!-- 配置最终通知：无论切入点方法是否正常执行它都会在其后面执行</span><br><span class="line">           &lt;aop:after method="afterPrintLog" pointcut-ref="pt1"&gt;&lt;/aop:after&gt;--&gt;</span><br><span class="line">           &lt;aop:around method=<span class="string">"aroundPringtLog"</span> pointcut-ref=<span class="string">"pt1"</span>/&gt;</span><br><span class="line">       &lt;/aop:aspect&gt;</span><br><span class="line">   &lt;/aop:config&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>环绕通知 XML的配置参照上段代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 环绕通知</span></span><br><span class="line"><span class="comment">    * 问题：</span></span><br><span class="line"><span class="comment">    *      当我们配置了环绕通知之后，切入点方法没有执行，而通知方法执行了。</span></span><br><span class="line"><span class="comment">    * 分析：</span></span><br><span class="line"><span class="comment">    *      通过对比动态代理中的环绕通知代码，发现动态代理的环绕通知有明确的切入点方法调用，而我们的代码中没有。</span></span><br><span class="line"><span class="comment">    * 解决：</span></span><br><span class="line"><span class="comment">    *      Spring框架为我们提供了一个接口：ProceedingJoinPoint。该接口有一个方法proceed()，此方法就相当于明确调用切入点方法。</span></span><br><span class="line"><span class="comment">    *      该接口可以作为环绕通知的方法参数，在程序执行时，spring框架会为我们提供该接口的实现类供我们使用。</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * spring中的环绕通知：</span></span><br><span class="line"><span class="comment">    *      它是spring框架为我们提供的一种可以在代码中手动控制增强方法何时执行的方式。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Object <span class="title">aroundPringtLog</span><span class="params">(ProceedingJoinPoint point)</span></span>&#123; <span class="comment">//Spring控制传入的参数, 拿来用及可以</span></span><br><span class="line">       <span class="comment">//point中有一个返回参数的方法</span></span><br><span class="line">       Object[] args = point.getArgs();</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           printLog();</span><br><span class="line">           Object proceed = point.proceed(args); <span class="comment">//此处调用service层的方法</span></span><br><span class="line">           afterReturningPrintLog();</span><br><span class="line">           <span class="keyword">return</span> proceed;</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Throwable throwable) &#123; <span class="comment">//此处异常较为特殊</span></span><br><span class="line">           afterThrowingPrintLog();</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">       &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">           afterPrintLog();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>XML配置详解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--spring中基于XML的AOP配置步骤</span><br><span class="line">    <span class="number">1</span>、把通知Bean也交给spring来管理</span><br><span class="line">    <span class="number">2</span>、使用aop:config标签表明开始AOP的配置</span><br><span class="line">    <span class="number">3</span>、使用aop:aspect标签表明配置切面</span><br><span class="line">            id属性：是给切面提供一个唯一标识</span><br><span class="line">            ref属性：是指定通知类bean的Id。</span><br><span class="line">    <span class="number">4</span>、在aop:aspect标签的内部使用对应标签来配置通知的类型</span><br><span class="line">           我们现在示例是让printLog方法在切入点方法执行之前之前：所以是前置通知</span><br><span class="line">           aop:before：表示配置前置通知</span><br><span class="line">                method属性：用于指定Logger类中哪个方法是前置通知</span><br><span class="line">                pointcut属性：用于指定切入点表达式，该表达式的含义指的是对业务层中哪些方法增强</span><br><span class="line"></span><br><span class="line">        切入点表达式的写法：</span><br><span class="line">            关键字：execution(表达式)</span><br><span class="line">            表达式：</span><br><span class="line">                访问修饰符  返回值  包名.包名.包名...类名.方法名(参数列表)</span><br><span class="line">            标准的表达式写法：</span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> com.itheima.service.impl.AccountServiceImpl.saveAccount()</span><br><span class="line">            访问修饰符可以省略</span><br><span class="line">                <span class="keyword">void</span> com.itheima.service.impl.AccountServiceImpl.saveAccount()</span><br><span class="line">            返回值可以使用通配符，表示任意返回值</span><br><span class="line">                * com.itheima.service.impl.AccountServiceImpl.saveAccount()</span><br><span class="line">            包名可以使用通配符，表示任意包。但是有几级包，就需要写几个*.</span><br><span class="line">                * *.*.*.*.AccountServiceImpl.saveAccount())</span><br><span class="line">            包名可以使用..表示当前包及其子包</span><br><span class="line">                * *..AccountServiceImpl.saveAccount()</span><br><span class="line">            类名和方法名都可以使用*来实现通配</span><br><span class="line">                * *..*.*()</span><br><span class="line">            参数列表：</span><br><span class="line">                可以直接写数据类型：</span><br><span class="line">                    基本类型直接写名称           <span class="keyword">int</span></span><br><span class="line">                    引用类型写包名.类名的方式   java.lang.String</span><br><span class="line">                可以使用通配符表示任意类型，但是必须有参数</span><br><span class="line">                可以使用..表示有无参数均可，有参数可以是任意类型</span><br><span class="line">            全通配写法：</span><br><span class="line">                * *..*.*(..)</span><br><span class="line"></span><br><span class="line">            实际开发中切入点表达式的通常写法：</span><br><span class="line">                切到业务层实现类下的所有方法</span><br><span class="line">                    * com.itheima.service.impl.*.*(..)</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>采用注解的方式实现AOP</p>
<ol>
<li><p>在XML文件中添加</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 配置spring创建容器时要扫描的包--&gt;</span><br><span class="line">   &lt;context:component-scan base-package="com.itheima"&gt;&lt;/context:component-scan&gt;</span><br><span class="line"></span><br><span class="line">   &lt;!-- 配置spring开启注解AOP的支持 --&gt;</span><br><span class="line">   &lt;aop:aspectj-autoproxy&gt;&lt;/aop:aspectj-autoproxy&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>纯注解方式时<br> 在配置类中添加@EnableAspectJAutoProxy</p>
</li>
<li><p>在切面类中的使用</p>
<ol>
<li>@Aspect 声明当前类是一个切面类</li>
<li>@Before(“pt1()”)....@Around(“pt1()”)  注解声明通知类型</li>
<li><p>指明切入点</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut</span>(<span class="string">"execution(* jhmarryme.service.impl.*.*(..))"</span>)</span><br><span class="line">  	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pt1</span><span class="params">()</span></span>&#123; &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用around时, 同xml配置方式的around相应方法</p>
<h2 id="对动态代理的学习"><a href="#对动态代理的学习" class="headerlink" title="对动态代理的学习"></a>对动态代理的学习</h2></li>
</ol>
</li>
</ol>
</li>
<li><p>基于接口的实现</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">final</span> Producer producer = <span class="keyword">new</span> Producer();</span><br><span class="line"></span><br><span class="line">       <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * 动态代理：</span></span><br><span class="line"><span class="comment">        *  特点：字节码随用随创建，随用随加载</span></span><br><span class="line"><span class="comment">        *  作用：不修改源码的基础上对方法增强</span></span><br><span class="line"><span class="comment">        *  分类：</span></span><br><span class="line"><span class="comment">        *      基于接口的动态代理</span></span><br><span class="line"><span class="comment">        *      基于子类的动态代理</span></span><br><span class="line"><span class="comment">        *  基于接口的动态代理：</span></span><br><span class="line"><span class="comment">        *      涉及的类：Proxy</span></span><br><span class="line"><span class="comment">        *      提供者：JDK官方</span></span><br><span class="line"><span class="comment">        *  如何创建代理对象：</span></span><br><span class="line"><span class="comment">        *      使用Proxy类中的newProxyInstance方法</span></span><br><span class="line"><span class="comment">        *  创建代理对象的要求：</span></span><br><span class="line"><span class="comment">        *      被代理类最少实现一个接口，如果没有则不能使用</span></span><br><span class="line"><span class="comment">        *  newProxyInstance方法的参数：</span></span><br><span class="line"><span class="comment">        *      ClassLoader：类加载器</span></span><br><span class="line"><span class="comment">        *          它是用于加载代理对象字节码的。和被代理对象使用相同的类加载器。固定写法。</span></span><br><span class="line"><span class="comment">        *      Class[]：字节码数组</span></span><br><span class="line"><span class="comment">        *          它是用于让代理对象和被代理对象有相同方法。固定写法。</span></span><br><span class="line"><span class="comment">        *      InvocationHandler：用于提供增强的代码</span></span><br><span class="line"><span class="comment">        *          它是让我们写如何代理。我们一般都是些一个该接口的实现类，通常情况下都是匿名内部类，但不是必须的。</span></span><br><span class="line"><span class="comment">        *          此接口的实现类都是谁用谁写。</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">      IProducer proxyProducer = (IProducer) Proxy.newProxyInstance(producer.getClass().getClassLoader(),</span><br><span class="line">               producer.getClass().getInterfaces(),</span><br><span class="line">               <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">                   <span class="comment">/**</span></span><br><span class="line"><span class="comment">                    * 作用：执行被代理对象的任何接口方法都会经过该方法</span></span><br><span class="line"><span class="comment">                    * 方法参数的含义</span></span><br><span class="line"><span class="comment">                    * <span class="doctag">@param</span> proxy   代理对象的引用</span></span><br><span class="line"><span class="comment">                    * <span class="doctag">@param</span> method  当前执行的方法</span></span><br><span class="line"><span class="comment">                    * <span class="doctag">@param</span> args    当前执行方法所需的参数</span></span><br><span class="line"><span class="comment">                    * <span class="doctag">@return</span>        和被代理对象方法有相同的返回值</span></span><br><span class="line"><span class="comment">                    * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">                    */</span></span><br><span class="line">                   <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                       <span class="comment">//提供增强的代码</span></span><br><span class="line">                       Object returnValue = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">                       <span class="comment">//1.获取方法执行的参数</span></span><br><span class="line">                       Float money = (Float)args[<span class="number">0</span>];</span><br><span class="line">                       <span class="comment">//2.判断当前方法是不是销售</span></span><br><span class="line">                       <span class="keyword">if</span>(<span class="string">"saleProduct"</span>.equals(method.getName())) &#123;</span><br><span class="line">                           returnValue = method.invoke(producer, money*<span class="number">0.8f</span>);</span><br><span class="line">                       &#125;</span><br><span class="line">                       <span class="keyword">return</span> returnValue;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;);</span><br><span class="line">       proxyProducer.saleProduct(<span class="number">10000f</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>基于子类的实现</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">final</span> Producer producer = <span class="keyword">new</span> Producer();</span><br><span class="line"></span><br><span class="line">       <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * 动态代理：</span></span><br><span class="line"><span class="comment">        *  特点：字节码随用随创建，随用随加载</span></span><br><span class="line"><span class="comment">        *  作用：不修改源码的基础上对方法增强</span></span><br><span class="line"><span class="comment">        *  分类：</span></span><br><span class="line"><span class="comment">        *      基于接口的动态代理</span></span><br><span class="line"><span class="comment">        *      基于子类的动态代理</span></span><br><span class="line"><span class="comment">        *  基于子类的动态代理：</span></span><br><span class="line"><span class="comment">        *      涉及的类：Enhancer</span></span><br><span class="line"><span class="comment">        *      提供者：第三方cglib库</span></span><br><span class="line"><span class="comment">        *  如何创建代理对象：</span></span><br><span class="line"><span class="comment">        *      使用Enhancer类中的create方法</span></span><br><span class="line"><span class="comment">        *  创建代理对象的要求：</span></span><br><span class="line"><span class="comment">        *      被代理类不能是最终类</span></span><br><span class="line"><span class="comment">        *  create方法的参数：</span></span><br><span class="line"><span class="comment">        *      Class：字节码</span></span><br><span class="line"><span class="comment">        *          它是用于指定被代理对象的字节码。</span></span><br><span class="line"><span class="comment">        *</span></span><br><span class="line"><span class="comment">        *      Callback：用于提供增强的代码</span></span><br><span class="line"><span class="comment">        *          它是让我们写如何代理。我们一般都是些一个该接口的实现类，通常情况下都是匿名内部类，但不是必须的。</span></span><br><span class="line"><span class="comment">        *          此接口的实现类都是谁用谁写。</span></span><br><span class="line"><span class="comment">        *          我们一般写的都是该接口的子接口实现类：MethodInterceptor</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       Producer cglibProducer = (Producer)Enhancer.create(producer.getClass(), <span class="keyword">new</span> MethodInterceptor() &#123;</span><br><span class="line">           <span class="comment">/**</span></span><br><span class="line"><span class="comment">            * 执行被代理  对象的任何方法都会经过该方法</span></span><br><span class="line"><span class="comment">            * <span class="doctag">@param</span> proxy</span></span><br><span class="line"><span class="comment">            * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">            * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">            *    以上三个参数和基于接口的动态代理中invoke方法的参数是一样的</span></span><br><span class="line"><span class="comment">            * <span class="doctag">@param</span> methodProxy ：当前执行方法的代理对象</span></span><br><span class="line"><span class="comment">            * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">            * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object proxy, Method method, Object[] args, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">               <span class="comment">//提供增强的代码</span></span><br><span class="line">               Object returnValue = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">               <span class="comment">//1.获取方法执行的参数</span></span><br><span class="line">               Float money = (Float)args[<span class="number">0</span>];</span><br><span class="line">               <span class="comment">//2.判断当前方法是不是销售</span></span><br><span class="line">               <span class="keyword">if</span>(<span class="string">"saleProduct"</span>.equals(method.getName())) &#123;</span><br><span class="line">                   returnValue = method.invoke(producer, money*<span class="number">0.8f</span>);</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="keyword">return</span> returnValue;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">       cglibProducer.saleProduct(<span class="number">12000f</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>实例中的使用</p>
<ol>
<li><p>beanFactory的编写:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> IAccountService accountService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTransactionManager</span><span class="params">(TransactionManager transactionManager)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.transactionManager = transactionManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TransactionManager transactionManager;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAccountService</span><span class="params">(IAccountService accountService)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.accountService = accountService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取service代理对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IAccountService <span class="title">getAccountService</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (IAccountService) Proxy.newProxyInstance(accountService.getClass().getClassLoader(), accountService.getClass().getInterfaces(), <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                <span class="comment">//增强service中的方法</span></span><br><span class="line">                Object returnVal = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line"><span class="comment">//                    1. 开启事务</span></span><br><span class="line">                    transactionManager.beginTransaction();</span><br><span class="line"><span class="comment">//                    2. 执行操作</span></span><br><span class="line">                    returnVal = method.invoke(accountService, args);</span><br><span class="line">                    <span class="keyword">int</span> i = <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line"><span class="comment">//                    3. 提交事务</span></span><br><span class="line">                    transactionManager.commit();</span><br><span class="line"><span class="comment">//                    4. 返回结果</span></span><br><span class="line">                    <span class="keyword">return</span> returnVal;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line"><span class="comment">//                    5. 回滚事务</span></span><br><span class="line">                    transactionManager.rollback();</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"><span class="comment">//                    6. 关闭连接</span></span><br><span class="line">                    transactionManager.release();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>bean.xml的配置<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--配置accountService对象--&gt;</span><br><span class="line">   &lt;bean id=<span class="string">"accountService"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"jhmarryme.service.impl.AccountServiceImpl"</span>&gt;</span><br><span class="line">       &lt;!--注入accountDao对象--&gt;</span><br><span class="line">       &lt;property name="accountDao" ref="accountDao"&gt;&lt;/property&gt;</span><br><span class="line">   &lt;/bean&gt;</span><br><span class="line">   &lt;!--配置accounDao对象--&gt;</span><br><span class="line">   &lt;bean id=<span class="string">"accountDao"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"jhmarryme.dao.impl.AccountDaoImpl"</span>&gt;</span><br><span class="line">       &lt;!--注入conn--&gt;</span><br><span class="line">       &lt;property name="connectionUtils" ref="conn"&gt;&lt;/property&gt;</span><br><span class="line">       &lt;!--注入runner--&gt;</span><br><span class="line">       &lt;property name="runner" ref="runner"&gt;&lt;/property&gt;</span><br><span class="line">   &lt;/bean&gt;</span><br><span class="line">   &lt;!--配置连接工具类--&gt;</span><br><span class="line">   &lt;bean id=<span class="string">"conn"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"jhmarryme.utils.ConnectionUtils"</span>&gt;</span><br><span class="line">       &lt;!--注入数据源--&gt;</span><br><span class="line">       &lt;property name="dataSource" ref="dataSource"&gt;&lt;/property&gt;</span><br><span class="line">   &lt;/bean&gt;</span><br><span class="line">   &lt;!--配置QueryRunner对象--&gt;</span><br><span class="line">   &lt;bean id=<span class="string">"runner"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.apache.commons.dbutils.QueryRunner"</span>&gt;</span><br><span class="line">   &lt;/bean&gt;</span><br><span class="line">   &lt;!--配置数据源--&gt;</span><br><span class="line">   &lt;bean id=<span class="string">"dataSource"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span><br><span class="line">       &lt;!--注入属性--&gt;</span><br><span class="line">       &lt;property name=<span class="string">"driverClass"</span> value=<span class="string">"com.mysql.jdbc.Driver"</span>/&gt;</span><br><span class="line">       &lt;property name=<span class="string">"jdbcUrl"</span> value=<span class="string">"jdbc:mysql://localhost:3306/test"</span>/&gt;</span><br><span class="line">       &lt;property name=<span class="string">"user"</span> value=<span class="string">"root"</span>/&gt;</span><br><span class="line">       &lt;property name=<span class="string">"password"</span> value=<span class="string">"541224"</span>/&gt;</span><br><span class="line">   &lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">   &lt;!--配置事务管理类--&gt;</span><br><span class="line">   &lt;bean id=<span class="string">"transactionManager"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"jhmarryme.utils.TransactionManager"</span>&gt;</span><br><span class="line">       &lt;property name=<span class="string">"connectionUtils"</span> ref=<span class="string">"conn"</span>/&gt;</span><br><span class="line">   &lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">   &lt;!--配置代理的service--&gt;</span><br><span class="line">   &lt;bean id=<span class="string">"proxyAccountService"</span> factory-bean=<span class="string">"beanFactory"</span> factory-method=<span class="string">"getAccountService"</span>&gt;</span><br><span class="line">	</span><br><span class="line">   &lt;/bean&gt;</span><br><span class="line">   &lt;!--配置代理beanFactory--&gt;</span><br><span class="line">   &lt;bean id=<span class="string">"beanFactory"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"jhmarryme.factoty.BeanFactory"</span>&gt;</span><br><span class="line">       &lt;property name=<span class="string">"accountService"</span> ref=<span class="string">"accountService"</span>/&gt;</span><br><span class="line">       &lt;property name=<span class="string">"transactionManager"</span> ref=<span class="string">"transactionManager"</span>/&gt;</span><br><span class="line">   &lt;/bean&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h2 id="对转账事务通过AOP方式的增强"><a href="#对转账事务通过AOP方式的增强" class="headerlink" title="对转账事务通过AOP方式的增强"></a>对转账事务通过AOP方式的增强</h2><pre><code>1. 导入依赖 
2. 在XML开启切面类的支持&lt;aop:aspectj-autoproxy&gt;&lt;/aop:aspectj-autoproxy&gt;
3. 编写切面类使用@Aspect注明是一个注解类 注册Bean对象@Component
4. 完成切面类中的方法调用及注入的管理
5. 编写测试类
</code></pre><p>至此今天的学习任务完成, 对AOP的概念了有了一定的理解, 对Spring中的AOP配置有所认识了, 熟练程度还是不够. 基本能完成AOP的关于XML和注解的配置.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://jhmarryme-1257584644.cos.ap-chengdu.myqcloud.com/hexo/jhmarryme.jpg" alt="Jiahao Wang">
            
              <p class="site-author-name" itemprop="name">Jiahao Wang</p>
              <p class="site-description motion-element" itemprop="description">blog</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">57</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jiahao Wang</span>
	
	<div class="powered-by">
	<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
	  本站访客数:<span id="busuanzi_value_site_uv"></span>
	</span>
	</div>

  
</div>


<!--
  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>
-->



  <span class="post-meta-divider">|</span>



<!--
  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>
-->




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
